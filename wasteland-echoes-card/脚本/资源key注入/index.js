const n=YAML;async function e(){const e=await async function(){const n=getCharWorldbookNames('current'),e=[];n.primary&&e.push(n.primary),e.push(...n.additional),e.push(...getGlobalWorldbookNames());const o=[...new Set(e)];for(const n of o)try{const e=(await getWorldbook(n)).find(n=>'[res]资源库'===n.name||n.name.includes('[res]'));if(e?.content)return console.info(`[资源key注入] 找到资源条目 "${e.name}" (enabled=${e.enabled}) in "${n}"`),e.content}catch{continue}return null}();if(!e)return void console.warn('[资源key注入] 未找到资源条目，跳过注入');const o=function(e){try{const o=n.parse(e);if(!o)return null;const t=['[可用资源key]'];if(o.角色立绘){const n=Object.entries(o.角色立绘).map(([n,e])=>`${n}(${Object.keys(e).join(',')})`);n.length&&t.push(`角色立绘: ${n.join(', ')}`)}if(o.背景图){const n=Object.keys(o.背景图);n.length&&t.push(`背景图: ${n.join(', ')}`)}if(o.BGM){const n=Object.keys(o.BGM);n.length&&t.push(`BGM: ${n.join(', ')}`)}if(o.CG){const n=Object.keys(o.CG);n.length&&t.push(`CG: ${n.join(', ')}`)}return t.length>1?t.join('\n'):null}catch(n){return console.error('[资源key注入] YAML 解析失败:',n),null}}(e);if(!o)return void console.warn('[资源key注入] 资源条目为空或解析失败，跳过注入');const{uninject:t}=injectPrompts([{id:'wasteland-echoes-resource-keys',position:'in_chat',depth:1,role:'system',content:o}]);console.info(`[资源key注入] 已注入资源 key 列表 (${o.length} chars)`),$(window).on('pagehide',()=>{t()})}$(()=>{errorCatched(e)()});
//# sourceMappingURL=index.js.map