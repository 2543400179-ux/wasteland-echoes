{"version":3,"file":"index.js","mappings":"AAAAA,EAAE,KAGA,SAASC,IACP,MAAMC,EAAUF,EAAE,gBAClB,GAAuB,IAAnBE,EAAQC,OAAc,OAAO,EAEjC,MAAMC,EAASF,EAAQG,OAAO,CAACC,EAAGC,IAAOP,EAAEO,GAAIC,KANtB,kBAM+CL,OAAS,GAEjF,GAAsB,IAAlBC,EAAOD,OAAc,OAAO,EAEhC,MAAMM,EAAeL,EAAOM,OAK5B,OAHAR,EAAQS,OACRF,EAAaG,QAEN,CACT,CAGA,IAAIC,EAAe,EACfC,EAAc,EAClB,MAEMC,EAAQC,YAAY,KACxB,MAAMC,EAAWjB,EAAE,gBAAgBG,OAE/Bc,IAAaJ,GAAgBI,EAAW,EAC1CH,KAEAA,EAAc,EACdD,EAAeI,GAGbH,GAZmB,GAajBb,KACFiB,cAAcH,IAGjB,KAGHI,QAAQC,cAAcC,iBAAkBpB,GACxCkB,QAAQC,cAAcE,eAAgBrB,GAGtC,IAAIsB,EAAkBC,YAAYC,mBAClCN,QAAQC,cAAcM,aAAcC,IAC9BJ,IAAoBI,IACtBJ,EAAkBI,EAClBC,OAAOC,SAASC","sources":["src://tavern_helper_template/src/wasteland-echoes-card/脚本/隐藏楼层/index.ts"],"sourcesContent":["$(() => {\n  const UI_IFRAME_SELECTOR = 'iframe[srcdoc]';\n\n  function applyVisibility() {\n    const $allMes = $('#chat > .mes');\n    if ($allMes.length === 0) return false;\n\n    const $uiMes = $allMes.filter((_, el) => $(el).find(UI_IFRAME_SELECTOR).length > 0);\n\n    if ($uiMes.length === 0) return false;\n\n    const $latestUiMes = $uiMes.last();\n\n    $allMes.hide();\n    $latestUiMes.show();\n\n    return true;\n  }\n\n  // 轮询等待历史楼层加载完成（全部用 jQuery，确保查询父页面 DOM）\n  let lastMesCount = 0;\n  let stableCount = 0;\n  const STABLE_THRESHOLD = 5;\n\n  const timer = setInterval(() => {\n    const mesCount = $('#chat > .mes').length;\n\n    if (mesCount === lastMesCount && mesCount > 0) {\n      stableCount++;\n    } else {\n      stableCount = 0;\n      lastMesCount = mesCount;\n    }\n\n    if (stableCount >= STABLE_THRESHOLD) {\n      if (applyVisibility()) {\n        clearInterval(timer);\n      }\n    }\n  }, 200);\n\n  // 后续新消息 / 编辑时重新计算\n  eventOn(tavern_events.MESSAGE_RECEIVED, applyVisibility);\n  eventOn(tavern_events.MESSAGE_EDITED, applyVisibility);\n\n  // 聊天切换时重载\n  let current_chat_id = SillyTavern.getCurrentChatId();\n  eventOn(tavern_events.CHAT_CHANGED, chat_id => {\n    if (current_chat_id !== chat_id) {\n      current_chat_id = chat_id;\n      window.location.reload();\n    }\n  });\n});\n"],"names":["$","applyVisibility","$allMes","length","$uiMes","filter","_","el","find","$latestUiMes","last","hide","show","lastMesCount","stableCount","timer","setInterval","mesCount","clearInterval","eventOn","tavern_events","MESSAGE_RECEIVED","MESSAGE_EDITED","current_chat_id","SillyTavern","getCurrentChatId","CHAT_CHANGED","chat_id","window","location","reload"],"sourceRoot":""}