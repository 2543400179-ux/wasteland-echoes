var __webpack_modules__ = {
  "./src/wasteland-echoes-card/脚本/隐藏楼层/index.ts"() {
    eval("{\n$(() => {\n    const UI_IFRAME_SELECTOR = 'iframe[srcdoc]';\n    function applyVisibility() {\n        const $allMes = $('#chat > .mes');\n        if ($allMes.length === 0)\n            return false;\n        const $uiMes = $allMes.filter((_, el) => $(el).find(UI_IFRAME_SELECTOR).length > 0);\n        if ($uiMes.length === 0)\n            return false;\n        const $latestUiMes = $uiMes.last();\n        $allMes.hide();\n        $latestUiMes.show();\n        return true;\n    }\n    // 轮询等待历史楼层加载完成（全部用 jQuery，确保查询父页面 DOM）\n    let lastMesCount = 0;\n    let stableCount = 0;\n    const STABLE_THRESHOLD = 5;\n    const timer = setInterval(() => {\n        const mesCount = $('#chat > .mes').length;\n        if (mesCount === lastMesCount && mesCount > 0) {\n            stableCount++;\n        }\n        else {\n            stableCount = 0;\n            lastMesCount = mesCount;\n        }\n        if (stableCount >= STABLE_THRESHOLD) {\n            if (applyVisibility()) {\n                clearInterval(timer);\n            }\n        }\n    }, 200);\n    // 后续新消息 / 编辑时重新计算\n    eventOn(tavern_events.MESSAGE_RECEIVED, applyVisibility);\n    eventOn(tavern_events.MESSAGE_EDITED, applyVisibility);\n    // 聊天切换时重载\n    let current_chat_id = SillyTavern.getCurrentChatId();\n    eventOn(tavern_events.CHAT_CHANGED, chat_id => {\n        if (current_chat_id !== chat_id) {\n            current_chat_id = chat_id;\n            window.location.reload();\n        }\n    });\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvd2FzdGVsYW5kLWVjaG9lcy1jYXJkL+iEmuacrC/pmpDol4/mpbzlsYIvaW5kZXgudHMiLCJtYXBwaW5ncyI6IjtBQUFBLENBQUMsQ0FBQyxHQUFHLEVBQUU7SUFDTCxNQUFNLGtCQUFrQixHQUFHLGdCQUFnQixDQUFDO0lBRTVDLFNBQVMsZUFBZTtRQUN0QixNQUFNLE9BQU8sR0FBRyxDQUFDLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDbEMsSUFBSSxPQUFPLENBQUMsTUFBTSxLQUFLLENBQUM7WUFBRSxPQUFPLEtBQUssQ0FBQztRQUV2QyxNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztRQUVwRixJQUFJLE1BQU0sQ0FBQyxNQUFNLEtBQUssQ0FBQztZQUFFLE9BQU8sS0FBSyxDQUFDO1FBRXRDLE1BQU0sWUFBWSxHQUFHLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUVuQyxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDZixZQUFZLENBQUMsSUFBSSxFQUFFLENBQUM7UUFFcEIsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRUQsdUNBQXVDO0lBQ3ZDLElBQUksWUFBWSxHQUFHLENBQUMsQ0FBQztJQUNyQixJQUFJLFdBQVcsR0FBRyxDQUFDLENBQUM7SUFDcEIsTUFBTSxnQkFBZ0IsR0FBRyxDQUFDLENBQUM7SUFFM0IsTUFBTSxLQUFLLEdBQUcsV0FBVyxDQUFDLEdBQUcsRUFBRTtRQUM3QixNQUFNLFFBQVEsR0FBRyxDQUFDLENBQUMsY0FBYyxDQUFDLENBQUMsTUFBTSxDQUFDO1FBRTFDLElBQUksUUFBUSxLQUFLLFlBQVksSUFBSSxRQUFRLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDOUMsV0FBVyxFQUFFLENBQUM7UUFDaEIsQ0FBQzthQUFNLENBQUM7WUFDTixXQUFXLEdBQUcsQ0FBQyxDQUFDO1lBQ2hCLFlBQVksR0FBRyxRQUFRLENBQUM7UUFDMUIsQ0FBQztRQUVELElBQUksV0FBVyxJQUFJLGdCQUFnQixFQUFFLENBQUM7WUFDcEMsSUFBSSxlQUFlLEVBQUUsRUFBRSxDQUFDO2dCQUN0QixhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDdkIsQ0FBQztRQUNILENBQUM7SUFDSCxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFFUixrQkFBa0I7SUFDbEIsT0FBTyxDQUFDLGFBQWEsQ0FBQyxnQkFBZ0IsRUFBRSxlQUFlLENBQUMsQ0FBQztJQUN6RCxPQUFPLENBQUMsYUFBYSxDQUFDLGNBQWMsRUFBRSxlQUFlLENBQUMsQ0FBQztJQUV2RCxVQUFVO0lBQ1YsSUFBSSxlQUFlLEdBQUcsV0FBVyxDQUFDLGdCQUFnQixFQUFFLENBQUM7SUFDckQsT0FBTyxDQUFDLGFBQWEsQ0FBQyxZQUFZLEVBQUUsT0FBTyxDQUFDLEVBQUU7UUFDNUMsSUFBSSxlQUFlLEtBQUssT0FBTyxFQUFFLENBQUM7WUFDaEMsZUFBZSxHQUFHLE9BQU8sQ0FBQztZQUMxQixNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQzNCLENBQUM7SUFDSCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwic291cmNlcyI6WyJzcmM6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlL3NyYy93YXN0ZWxhbmQtZWNob2VzLWNhcmQv6ISa5pysL+makOiXj+alvOWxgi9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIkKCgpID0+IHtcbiAgY29uc3QgVUlfSUZSQU1FX1NFTEVDVE9SID0gJ2lmcmFtZVtzcmNkb2NdJztcblxuICBmdW5jdGlvbiBhcHBseVZpc2liaWxpdHkoKSB7XG4gICAgY29uc3QgJGFsbE1lcyA9ICQoJyNjaGF0ID4gLm1lcycpO1xuICAgIGlmICgkYWxsTWVzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIGZhbHNlO1xuXG4gICAgY29uc3QgJHVpTWVzID0gJGFsbE1lcy5maWx0ZXIoKF8sIGVsKSA9PiAkKGVsKS5maW5kKFVJX0lGUkFNRV9TRUxFQ1RPUikubGVuZ3RoID4gMCk7XG5cbiAgICBpZiAoJHVpTWVzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIGZhbHNlO1xuXG4gICAgY29uc3QgJGxhdGVzdFVpTWVzID0gJHVpTWVzLmxhc3QoKTtcblxuICAgICRhbGxNZXMuaGlkZSgpO1xuICAgICRsYXRlc3RVaU1lcy5zaG93KCk7XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8vIOi9ruivouetieW+heWOhuWPsualvOWxguWKoOi9veWujOaIkO+8iOWFqOmDqOeUqCBqUXVlcnnvvIznoa7kv53mn6Xor6LniLbpobXpnaIgRE9N77yJXG4gIGxldCBsYXN0TWVzQ291bnQgPSAwO1xuICBsZXQgc3RhYmxlQ291bnQgPSAwO1xuICBjb25zdCBTVEFCTEVfVEhSRVNIT0xEID0gNTtcblxuICBjb25zdCB0aW1lciA9IHNldEludGVydmFsKCgpID0+IHtcbiAgICBjb25zdCBtZXNDb3VudCA9ICQoJyNjaGF0ID4gLm1lcycpLmxlbmd0aDtcblxuICAgIGlmIChtZXNDb3VudCA9PT0gbGFzdE1lc0NvdW50ICYmIG1lc0NvdW50ID4gMCkge1xuICAgICAgc3RhYmxlQ291bnQrKztcbiAgICB9IGVsc2Uge1xuICAgICAgc3RhYmxlQ291bnQgPSAwO1xuICAgICAgbGFzdE1lc0NvdW50ID0gbWVzQ291bnQ7XG4gICAgfVxuXG4gICAgaWYgKHN0YWJsZUNvdW50ID49IFNUQUJMRV9USFJFU0hPTEQpIHtcbiAgICAgIGlmIChhcHBseVZpc2liaWxpdHkoKSkge1xuICAgICAgICBjbGVhckludGVydmFsKHRpbWVyKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sIDIwMCk7XG5cbiAgLy8g5ZCO57ut5paw5raI5oGvIC8g57yW6L6R5pe26YeN5paw6K6h566XXG4gIGV2ZW50T24odGF2ZXJuX2V2ZW50cy5NRVNTQUdFX1JFQ0VJVkVELCBhcHBseVZpc2liaWxpdHkpO1xuICBldmVudE9uKHRhdmVybl9ldmVudHMuTUVTU0FHRV9FRElURUQsIGFwcGx5VmlzaWJpbGl0eSk7XG5cbiAgLy8g6IGK5aSp5YiH5o2i5pe26YeN6L29XG4gIGxldCBjdXJyZW50X2NoYXRfaWQgPSBTaWxseVRhdmVybi5nZXRDdXJyZW50Q2hhdElkKCk7XG4gIGV2ZW50T24odGF2ZXJuX2V2ZW50cy5DSEFUX0NIQU5HRUQsIGNoYXRfaWQgPT4ge1xuICAgIGlmIChjdXJyZW50X2NoYXRfaWQgIT09IGNoYXRfaWQpIHtcbiAgICAgIGN1cnJlbnRfY2hhdF9pZCA9IGNoYXRfaWQ7XG4gICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4gICAgfVxuICB9KTtcbn0pO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/wasteland-echoes-card/脚本/隐藏楼层/index.ts\n\n}");
  }
};

var __webpack_exports__ = {};

__webpack_modules__["./src/wasteland-echoes-card/脚本/隐藏楼层/index.ts"]();